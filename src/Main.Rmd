---
title: "STAT 346 Final Project"
author: "Eddy D. Varela, Chenyang Sun, Jackson Bibbens"
date: "4/20/2020"
output: pdf_document
---

```{r}
library(data.table)
confirmedCasesUS = fread('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv')
confirmedDeathsUS = fread('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv')
hospitalData = read.csv('data/Hospitals.csv', header = TRUE)
mobilityReport = fread('https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv')
stayHomeClean = read.csv('data/StayHomeOrder.csv', header = TRUE)

head(confirmedCasesUS)
head(confirmedDeathsUS)
head(stayHomeClean)
hospitalData

```

Preprocessing data to fix column names and remove columns that we are not going to use:
```{r}
library(tidyverse)

#Confirmed Cases
casesClean = confirmedCasesUS[,-2:-5]
casesClean = casesClean[,-7]
names(casesClean)[names(casesClean) == "Admin2"] <- "County"

#Confirmed Deaths
deathesClean = confirmedDeathsUS[,-2:-5]
deathesClean = deathesClean[,-7]
names(deathesClean)[names(deathesClean) == "Admin2"] <- "County"

#Hospital Data
hospitalClean = hospitalData %>% filter(
  TYPE == "GENERAL ACUTE CARE" | TYPE == "LONG TERM CARE"|
  TYPE == "CRITICAL ACCESS" | TYPE == "CHILDREN")

# we want to anonymize the name of the hospital and remove lat/longitude data, and other id and columns where all the values are the same. We have also removed hospitals that would not be treating people who are infected with the virus.

head(hospitalData)
hospitalClean = hospitalData[,-c(1:6, 10:11, 16, 17, 20, 22:29,31,34)]
hospitalClean
rapply(hospitalData,function(x)length(unique(x)))

types = hospitalData$TYPE[!duplicated(hospitalData$TYPE)]

#Filtering out the regions that are not the United States, each row is a day where the columns represent the %change  from baseline in different categories such as retail, transit, parks, etc...
# When both sub_region_1 and sub_region_2 is empty then we are looking at the whole US
# When sub_region_2 is empty we are looking at the statewide mobility report, I am keeping these in for future use cases.
mobilityReportClean = mobilityReport[which(mobilityReport$country_region=='United States')]


head(casesClean)
head(deathesClean)
head(hospitalClean)
mobilityReportClean
head(stayHomeClean)
```

```{r StayHome}
# Need to translate StayHome date into a category "bucket" 
# Group 1: Orders on/before 3/23
# Group 2: Orders between 3/24 - 3/26
# Group 3: Orders between 3/27 - 3/31
# Group 4: Orders on/after 4/1
stayHomeClean$Start.Date = as.Date(stayHomeClean$Start.Date)

#Creating Dummy Variables for each group
stayHomeClean$start.1 = ifelse(stayHomeClean$Start.Date <= as.Date('2020-03-23'),1,0)
stayHomeClean$start.2 = ifelse(stayHomeClean$Start.Date > as.Date('2020-03-23') & stayHomeClean$Start.Date <= as.Date('2020-03-26') ,1,0)
stayHomeClean$start.3 = ifelse(stayHomeClean$Start.Date > as.Date('2020-03-26') & stayHomeClean$Start.Date <= as.Date('2020-03-31'),1,0)
stayHomeClean$start.4 = ifelse(stayHomeClean$Start.Date >= as.Date('2020-04-01'),1,0)

```

```{r income}
# Adding data set for per capital income 2018 for each county
incomeData = read.csv('data/lapi1119.csv',header = TRUE)
```

```{r countyData}
#Create a unified "countyData" table which will link each county to: 
# mortality rate, total cases, total deaths, # beds, ∆retail, ∆grocery, ∆parks, ∆transit, ∆work, ∆residential, stay at home, income

#Will need to merge the datasets 

```





